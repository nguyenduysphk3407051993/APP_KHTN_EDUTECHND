services:
  # App Configuration
  web-app:
    build: .
    container_name: khtn-app
    restart: always
    networks:
      - traefik-net # <--- QUAN TRỌNG: Đổi tên này thành tên network của Traefik cũ (vd: web, proxy, traefik_public)
    labels:
      - "traefik.enable=true"

      # Routing
      - "traefik.http.routers.khtn-app.rule=Host(`khtnapp.edutechnd.org`)"
      - "traefik.http.routers.khtn-app.entrypoints=websecure"

      # SSL: Thay 'myresolver' bằng tên resolver trong Traefik cũ (thường là 'le', 'letsencrypt' hoặc 'myresolver')
      - "traefik.http.routers.khtn-app.tls.certresolver=letsencrypt" # Thử đổi thành 'letsencrypt'

      # Redirect HTTP -> HTTPS (Tự định nghĩa middleware trên container này)
      - "traefik.http.middlewares.khtn-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.khtn-app-http.rule=Host(`khtnapp.edutechnd.org`)"
      - "traefik.http.routers.khtn-app-http.entrypoints=web"
      - "traefik.http.routers.khtn-app-http.middlewares=khtn-redirect"

# Định nghĩa mạng ngoài
networks:
  traefik-net:
    # <--- Tên này phải trùng với tên network bên trên
    external: true
